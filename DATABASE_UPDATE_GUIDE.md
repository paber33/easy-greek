# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**

–¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç–∞—Ä—ã–µ FSRS –ø–æ–ª—è**, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ **SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º**. –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## üîç **–ß—Ç–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å**

### –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è (FSRS) ‚Üí –ù–æ–≤—ã–µ –ø–æ–ª—è (SM-2)
- `difficulty` (1-10) ‚Üí `ease` (Ease Factor, 1.3-3.0)
- `stability` (–¥–Ω–∏) ‚Üí `interval_days` (–¥–Ω–∏)
- `current_step` ‚Üí `learning_step_index`

### –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `examples` - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `notes` - –∑–∞–º–µ—Ç–∫–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
- `pronunciation` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- `audio_url` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ
- `image_url` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## üöÄ **–ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å**

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ –≤–∞—à–µ–º Supabase –ø—Ä–æ–µ–∫—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `update-database-schema.sql`:

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
ALTER TABLE cards 
ADD COLUMN IF NOT EXISTS ease DECIMAL(3,2) DEFAULT 2.5 CHECK (ease >= 1.3),
ADD COLUMN IF NOT EXISTS interval_days INTEGER DEFAULT 0 CHECK (interval_days >= 0),
ADD COLUMN IF NOT EXISTS learning_step_index INTEGER;

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
ALTER TABLE cards 
ADD COLUMN IF NOT EXISTS examples TEXT[],
ADD COLUMN IF NOT EXISTS notes TEXT,
ADD COLUMN IF NOT EXISTS pronunciation TEXT,
ADD COLUMN IF NOT EXISTS audio_url TEXT,
ADD COLUMN IF NOT EXISTS image_url TEXT;

-- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –≤ –Ω–æ–≤—ã–µ
UPDATE cards 
SET 
  ease = CASE 
    WHEN difficulty IS NOT NULL THEN 
      -- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º difficulty (1-10) –≤ ease (1.3-3.0)
      GREATEST(1.3, LEAST(3.0, 2.5 - (difficulty - 6.0) * 0.1))
    ELSE 2.5 
  END,
  interval_days = CASE 
    WHEN stability IS NOT NULL THEN GREATEST(0, ROUND(stability))
    ELSE 0 
  END,
  learning_step_index = current_step
WHERE ease IS NULL OR interval_days IS NULL;
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—è –¥–æ–±–∞–≤–∏–ª–∏—Å—å:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns 
WHERE table_name = 'cards' 
ORDER BY ordinal_position;
```

### 3. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø—ã TypeScript

–¢–∏–ø—ã –≤ `types/index.ts` —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π.

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü–∞ `cards` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

### ‚úÖ **SM-2 –ø–æ–ª—è**
- `ease` - Ease Factor (1.3-3.0)
- `interval_days` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –¥–Ω—è—Ö
- `learning_step_index` - —Ç–µ–∫—É—â–∏–π —à–∞–≥ –∏–∑—É—á–µ–Ω–∏—è

### ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç**
- `examples` - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `notes` - –∑–∞–º–µ—Ç–∫–∏
- `pronunciation` - –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ
- `audio_url` - –∞—É–¥–∏–æ —Ñ–∞–π–ª
- `image_url` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### ‚úÖ **Legacy –ø–æ–ª—è (—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)**
- `difficulty` - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `stability` - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `current_step` - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## üîÑ **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

SQL —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç** `difficulty` ‚Üí `ease` –ø–æ —Ñ–æ—Ä–º—É–ª–µ
2. **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç** `stability` ‚Üí `interval_days`
3. **–ö–æ–ø–∏—Ä—É–µ—Ç** `current_step` ‚Üí `learning_step_index`
4. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç** —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## ‚ö†Ô∏è **–í–∞–∂–Ω–æ**

- **–°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **Legacy –ø–æ–ª—è** –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ

## üéØ **–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–º–æ–∂–µ—Ç:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º —Å Supabase
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏ –∑–∞–º–µ—Ç–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–º–∏–≥—Ä–∞—Ü–∏—è)
